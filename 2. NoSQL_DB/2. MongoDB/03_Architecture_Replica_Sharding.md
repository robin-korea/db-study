# 03. MongoDB 아키텍처: Replica Set & Sharding

## 1. Replica Set (고가용성, HA)
서버 장애에 대비해 데이터를 복제(Replication)하여 서비스를 지속하게 하는 기술. 최소 3대 이상의 서버로 구성된다.

### 1.1 구성 요소
* **Primary (1대):** 클라이언트의 모든 **쓰기(Write)**와 읽기(Read) 요청을 처리하는 리더.
* **Secondary (N대):** Primary의 작업 로그(**Oplog**)를 비동기로 복제하여 데이터를 동기화하는 팔로워.
* **Arbiter (옵션):** 데이터는 저장하지 않고, Primary 선출 투표에만 참여하는 감시자.

### 1.2 자동 장애 복구 (Failover)
Primary 서버가 다운되면, 남은 Secondary들끼리 **투표(Election)**를 진행하여 새로운 Primary를 자동으로 선출한다. 이를 통해 서비스 중단 시간을 최소화한다.

---

## 2. Sharding (확장성, Scale-Out)
데이터가 너무 커서 한 대의 서버 용량을 초과하거나 성능 한계가 올 때, 데이터를 여러 서버(Shard)에 **수평 분할(Partitioning)**하여 저장하는 기술.

### 2.1 핵심 컴포넌트
1.  **Mongos (Router):** 클라이언트의 요청을 받아서, 데이터가 어느 샤드에 있는지 확인 후 전달하는 중계자. (애플리케이션은 뒤단에 샤드가 몇 개인지 몰라도 됨)
2.  **Config Server:** 전체 클러스터의 메타데이터(어떤 데이터 청크가 어떤 샤드에 있는지)를 관리하는 지도 역할.
3.  **Shard:** 실제 데이터가 저장되는 머신. (운영 환경에서는 각 샤드도 Replica Set으로 구성됨)

### 2.2 Shard Key (성능의 핵심)
데이터를 어떤 기준으로 쪼갤지 결정하는 키.
* **Cardinality(분별력)가 높은 키**를 선택해야 데이터가 한쪽 샤드에 쏠리는 현상(**Data Skew**)을 막을 수 있다.
* 잘못된 샤드 키를 쓰면 특정 샤드만 과부하가 걸려 샤딩의 효과가 사라진다.
