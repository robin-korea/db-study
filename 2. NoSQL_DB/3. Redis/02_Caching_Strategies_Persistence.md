# 02. 캐싱 전략과 영속성 (Persistence)

## 1. 캐싱 전략 (Caching Patterns)
Redis를 DB 앞단에 캐시로 둘 때 가장 많이 쓰는 패턴은 **Look Aside (Lazy Loading)** 방식이다.

1.  애플리케이션이 데이터를 찾을 때 **Redis(Cache)**를 먼저 찌른다.
2.  **Hit:** 있으면 바로 반환 (DB 부하 0).
3.  **Miss:** 없으면 **DB**에서 조회 후, Redis에 저장(`SET`)하고 반환.

> **TTL (Time To Live):** 캐시 데이터가 영원히 남아있지 않도록 만료 시간(`EXPIRE`)을 설정하는 것이 필수다.

---

## 2. 영속성 (Persistence)
Redis는 메모리 DB라서 전원이 꺼지면 데이터가 다 날아간다. 이를 방지하기 위해 디스크에 백업하는 두 가지 방법이 있다.

### 2.1 RDB (Redis Database) - 스냅샷
* **방식:** 특정 간격(예: 1시간)마다 메모리 전체를 스냅샷 떠서 파일로 저장.
* **장점:** 로딩 속도가 빠르고 파일 크기가 작다.
* **단점:** 스냅샷 직후에 서버가 죽으면, **마지막 스냅샷 이후의 데이터는 유실된다.**

### 2.2 AOF (Append Only File) - 로그 기록
* **방식:** 모든 쓰기(Write) 명령어를 파일에 순서대로 기록(Append).
* **장점:** 데이터 유실이 거의 없다 (실시간 기록).
* **단점:** 파일 크기가 엄청나게 커질 수 있고, 복구(Replay) 속도가 느리다.

> **결론:** 중요 데이터라면 RDB와 AOF를 혼용해서 사용한다. 단순 캐시 용도라면 둘 다 끄고 성능을 높이기도 한다.

---

## 3. 메모리 관리 (Eviction Policy)
메모리가 꽉 찼을 때 어떤 데이터를 지울 것인가?
* **volatile-lru:** 만료 시간(TTL)이 설정된 키 중 가장 오랫동안 안 쓴 것(LRU) 삭제.
* **allkeys-lru:** (가장 많이 씀) 모든 키 중에서 가장 오랫동안 안 쓴 것 삭제.
