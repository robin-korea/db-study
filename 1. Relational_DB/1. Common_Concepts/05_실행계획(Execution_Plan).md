# [DB] 실행 계획 (Execution Plan) 핵심 개념 정리

## 1. 실행 계획(Execution Plan)이란?

**정의:** 사용자가 작성한 **SQL 쿼리를 데이터베이스가 어떤 순서와 방식으로 실행할 것인지**에 대한 상세한 **'작업 계획서'** 또는 **'설계도'**.

-   **핵심 목적:** 쿼리 성능 튜닝. 내가 만든 쿼리가 비효율적으로 작동하는 원인을 찾기 위해 사용된다.
-   SQL 쿼리는 단지 '무엇을 원하는지(What)'를 선언할 뿐, '어떻게 가져올지(How)'는 데이터베이스가 결정한다. 실행 계획은 바로 이 '어떻게'에 대한 구체적인 방법을 보여준다.

> **쉬운 예시: "서울역에서 부산역 가는 법"**
> -   **SQL 쿼리:** "서울역에서 부산역까지 가고 싶다."
> -   **실행 계획:** "1. 먼저 서울역에서 KTX를 탄다. 2. 대전역을 경유한다. 3. 동대구역을 경유한다. 4. 부산역에 도착한다. (예상 소요 시간: 2시간 30분)"

---

## 2. 옵티마이저 (Optimizer)

**정의:** 가장 효율적인 실행 계획을 수립해주는 데이터베이스의 **'두뇌'**.

-   사용자가 쿼리를 실행하면, 옵티마이저는 해당 쿼리를 분석하고, 테이블의 데이터 분포 통계, 인덱스 유무 등을 고려하여 가장 비용(시간과 자원)이 적게 드는 실행 계획을 선택한다.
-   옵티마이저가 항상 최적의 계획을 세우는 것은 아니기 때문에, 개발자는 실행 계획을 직접 보고 옵티마이저가 더 좋은 선택을 하도록 쿼리를 수정하거나 인덱스를 생성해줘야 한다.

---

## 3. 실행 계획에서 확인해야 할 핵심 포인트

실행 계획을 볼 때는 내가 의도한 대로 DB가 효율적으로 움직이는지를 확인해야 한다.

### ① Full Table Scan (전체 테이블 스캔)

-   **의미:** 인덱스를 사용하지 못하고, 테이블의 모든 데이터를 처음부터 끝까지 하나씩 다 읽는 최악의 방식.
-   **확인:** 실행 계획에 `Full Table Scan` 또는 `Table Scan`이라는 문구가 보인다면, 해당 쿼리가 매우 비효율적일 가능성이 높다는 신호이다.
-   **해결책:** `WHERE` 절의 조건에 맞는 인덱스를 생성하여 `Index Scan`으로 유도해야 한다.

### ② Index Scan (인덱스 스캔)

-   **의미:** 인덱스를 사용하여 필요한 데이터만 효율적으로 찾아가는 방식.
-   **종류:**
    -   **Index Unique Scan:** `UNIQUE` 인덱스를 통해 단 하나의 결과만 찾는 가장 빠른 방식.
    -   **Index Range Scan:** `=` 뿐만 아니라 `<`, `>`, `BETWEEN` 등의 연산자로 일정 범위의 데이터를 인덱스를 통해 효율적으로 찾는 방식.

---

## 4. 왜 개발자가 실행 계획을 알아야 할까?

-   **느린 쿼리(Slow Query)의 원인 분석:** 서비스 속도를 저하 시키는 쿼리가 있을 때, 실행 계획을 통해 왜 느린지(예: 인덱스를 사용하지 않아서) 정확한 원인을 파악할 수 있다.
-   **인덱스의 효과 검증:** 새로 만든 인덱스가 실제 쿼리에서 잘 사용되고 있는지 실행 계획을 통해 확인할 수 있다.
-   **성능 예측:** 복잡한 쿼리를 작성했을 때, 실행 계획을 미리 확인하여 배포 전에 성능 문제를 예측하고 개선할 수 있다.

> **결론:** 실행 계획을 볼 줄 안다는 것은, DB의 내부 동작을 이해하고, 내가 작성한 코드의 성능을 스스로 분석하고 책임질 수 있는 역량을 갖추었다는 의미이다.
